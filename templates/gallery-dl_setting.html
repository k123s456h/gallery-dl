{% extends "base.html" %}
{% block content %}
<div>
  {{ macros.m_button_group([['global_setting_save_btn', '설정 저장']])}}
  {{ macros.m_row_start('5') }}
  {{ macros.m_row_end() }}
  <nav>
    {{ macros.m_tab_head_start() }}
    {{ macros.m_tab_head2('normal', '일반', true) }}
    {{ macros.m_tab_head2('options', '옵션', false) }}
    {{ macros.m_tab_head_end() }}
  </nav>
  <form id='setting' name='setting'>
    <div class="tab-content" id="nav-tabContent">
      {{ macros.m_tab_content_start('normal', true) }}
      {{ macros.setting_button([['install_btn', '설치/업데이트'], ['uninstall_btn', '삭제']], 'gallery-dl', '현재 버전: ' + arg['current_version'] ) }}
      {{ macros.m_hr()}}
      {{ macros.info_text_go('github-gallery-dl', '원작자 repo', 'https://github.com/mikf/gallery-dl') }}
      {{ macros.m_tab_content_end() }}


      {{ macros.m_tab_content_start('options', false) }}
      <!-- --option -->
      {{ macros.setting_input_textarea('gallery-dl_option_value', '/etc/gallery-dl.conf 설정', value=arg['gallery-dl_option_value'], col='20', row='30', desc=['참고: https://github.com/mikf/gallery-dl/blob/master/docs/gallery-dl-example.conf']) }}
      {{ macros.m_tab_content_end() }}

      {{ macros.m_tab_content_start('auto', false) }}
      {{ macros.setting_global_scheduler_button(arg['scheduler'], arg['is_running']) }}
      {{ macros.setting_input_text('interval', '스케쥴링 실행 정보', value=arg['interval'], col='3', desc=['Inverval(minute 단위)이나 Cron 설정']) }}
      {{ macros.setting_input_int('pagecount', '탐색 페이지수', value=arg['pagecount'], min='1', placeholder='1')}}
      {{ macros.setting_checkbox('auto_start', '시작시 자동실행', value=arg['auto_start'], desc='On : 시작시 자동으로 스케쥴러에 등록됩니다.') }}
      {{ macros.setting_input_textarea('downlist', '자동 다운로드 할 만화 이름', value=arg['downlist'], row='5', desc=['구분자 |', '빈칸인 경우 모두 다운로드합니다.']) }}
      {{ macros.setting_input_textarea('blacklist', '다운로드 제외 만화 이름', value=arg['blacklist'], row='3', desc=['구분자 |']) }}
      {{ macros.setting_checkbox('all_download', 'All Download', value=arg['all_download'], desc=['On : 새로운 에피소드를 받을 때 이전 화 전부를 다운합니다.', '이미 받은 경우 제외']) }}
      {{ macros.m_tab_content_end() }}
    </div>
    <!--tab-content-->
  </form>
</div>
<!--전체-->

<script type="text/javascript">

  let package_name = "{{ arg['package_name'] }}";
  let is_installed = "{{ arg['is_installed'] }}" == "True" ? true : false;
  let current_version = "{{ arg['current_version'] }}"
  console.log(package_name, is_installed, current_version)

  $(document).ready(function () {
    $('[id^=gallery-dl]').each(function (index) {
      use_collapse(this.id)
    });
  });

  $("body").on('click', '#install_btn', function (e) {
    $.get({
      url: '/' + package_name + '/ajax/install',
      success: function (data) {
        command_modal_show('설치')
      }
    });
  });

  $("body").on('click', '#uninstall_btn', function (e) {
    $.get({
      url: '/' + package_name + '/ajax/uninstall',
      success: function (data) {
        command_modal_show('제거')
      }
    });
  });

  $('[id^=gallery-dl]').change(function () {
    use_collapse(this.id);
  });


  // $("body").on('click', '#uninstall_btn', function (e) {
  //   $.ajax({
  //     url: '/' + package_name + '/ajax/uninstall',
  //     type: "POST",
  //     cache: false,
  //     data: {},
  //     dataType: "json",
  //     success: function (data) {
  //       command_modal_show('제거')
  //     }
  //   });
  // });

</script>
{% endblock %}