{% extends "base.html" %}
{% block content %}
<div>
  {{ macros.m_button_group([['global_setting_save_btn', '설정 저장']])}}
  {{ macros.m_row_start('5') }}
  {{ macros.m_row_end() }}
  <nav>
    {{ macros.m_tab_head_start() }}
    {{ macros.m_tab_head2('normal', '일반', true) }}
    {{ macros.m_tab_head2('options', '옵션', false) }}
    {{ macros.m_tab_head2('hitomi', '자동-hitomi', false) }}
    {{ macros.m_tab_head2('etc', '기타', false) }}
    {{ macros.m_tab_head_end() }}
  </nav>
  <form id='setting' name='setting'>
    <div class="tab-content" id="nav-tabContent">
      {{ macros.m_tab_content_start('normal', true) }}
        {{ macros.setting_button([['install_btn', '설치/업데이트'], ['uninstall_btn', '삭제']], 'gallery-dl', '현재 버전: ' + arg['current_version'] ) }}
        {{ macros.m_hr()}}
        {{ macros.info_text_go('github-gallery-dl', '원작자 repo', 'https://github.com/mikf/gallery-dl') }}
      {{ macros.m_tab_content_end() }}
      

      {{ macros.m_tab_content_start('options', false) }}
        {{ macros.setting_input_text('dfolder', '다운로드 경로', value=arg['dfolder'], desc=['다운로드 경로입니다.', 'SJVA Root 경로가 포함되어 있어야 뷰어를 통해 볼 수 있습니다.']) }}
        {{ macros.setting_checkbox('zip', 'ZIP', value=arg['zip'], desc=['On : 압축', 'Off : 개별 파일']) }}
    
        <!-- --proxy -->
        {{ macros.setting_checkbox('gallery-dl_proxy', '프록시 사용', value=arg['gallery-dl_proxy'], desc=['On: 다운로드에 프록시를 사용합니다.']) }}
        <div id="gallery-dl_proxy_div" class="collapse">
          {{ macros.setting_input_text('gallery-dl_proxy_url', '프록시 사용', value=arg['gallery-dl_proxy_url'], desc=['url:port']) }}
        </div>
    
        <!-- --limit-rate -->
        {{ macros.setting_checkbox('gallery-dl_limit-rate', '다운로드 속도 제한', value=arg['gallery-dl_limit-rate'], desc=['On: 다운로드에 속도제한을 사용합니다.']) }}
        <div id="gallery-dl_limit-rate_div" class="collapse">
          {{ macros.setting_input_text('gallery-dl_limit-rate_value', '제한 속도', value=arg['gallery-dl_limit-rate_value'], desc=['예: 500k, 2.5M']) }}
        </div>
    
        <!-- retries -->
        {{ macros.setting_checkbox('gallery-dl_retries', '재시도 회수', value=arg['gallery-dl_retries'], desc=['On: 다운로드 실패 시에 재시도 합니다.']) }}
        <div id="gallery-dl_retries_div" class="collapse">
          {{ macros.setting_input_text('gallery-dl_retries_value', '값', value=arg['gallery-dl_retries_value'], desc=['예: 3']) }}
        </div>
    
        <!-- --sleep -->
        {{ macros.setting_checkbox('gallery-dl_sleep', 'sleep', value=arg['gallery-dl_sleep'], desc=['On: 각 다운로드 사이에 n초 쉽니다.']) }}
        <div id="gallery-dl_sleep_div" class="collapse">
          {{ macros.setting_input_text('gallery-dl_sleep_value', '값', value=arg['gallery-dl_sleep_value'], desc=['예: 3']) }}
        </div>
    
        <!-- --username, --password -->
        {{ macros.setting_checkbox('gallery-dl_auth', '로그인 사용', value=arg['gallery-dl_auth'], desc=['On: 다운로드에 로그인을 사용합니다.', 
        'pixiv, nijie, seiga에는 필수.', 
        'danbooru, e621, exhentai, idolcomplex, instagram, luscious, sankaku, tsumino, twitter에는 선택.']) }}
        <div id="gallery-dl_auth_div" class="collapse">
          {{ macros.setting_input_textarea('gallery-dl_auth_info', '인증정보', value=arg['gallery-dl_auth_info'], desc=['입력 형식: ', "['site1':'['id', 'pw']'], 'site2': '['id', 'pw']', ]"]) }}
        </div>
    
        <!-- --write-metadata -->
        {{ macros.setting_checkbox('gallery-dl_write-metadata', 'metadata 쓰기', value=arg['gallery-dl_write-metadata'], desc=['On: 다운로드한 폴더에 json파일을 생성합니다.']) }}
    
        <!-- --option -->
        {{ macros.setting_checkbox('gallery-dl_option', '기타 옵션', value=arg['gallery-dl_option'], desc=['On: gallery-dl 기타 옵션을 사용합니다.']) }}
        <div id="gallery-dl_option_div" class="collapse">
          {{ macros.setting_input_textarea('gallery-dl_option_value', '값', value=arg['gallery-dl_option_value'], desc=["예:[ 'extractor.*.filename': '({gallery_id})[{artist}][{series}].{title}.{filename}.{extension}',
            'extractor.*.cookies-update': 'true',  ]", '참고: https://github.com/mikf/gallery-dl/blob/master/docs/configuration.rst', 'bool값은 소문자로 입력.']) }}
        </div>
      {{ macros.m_tab_content_end() }}

      
      {{ macros.m_tab_content_start('hitomi', false) }}
        {{ macros.m_hr()}}
        {{ macros.info_text('hitomi-setting', 'test', value='123', desc=['']) }}
        {{ macros.m_hr()}}
      {{ macros.m_tab_content_end() }}

  
      {{ macros.m_tab_content_start('auto', false) }}
        {{ macros.setting_global_scheduler_button(arg['scheduler'], arg['is_running']) }}
        {{ macros.setting_input_text('interval', '스케쥴링 실행 정보', value=arg['interval'], col='3', desc=['Inverval(minute 단위)이나 Cron 설정']) }}
        {{ macros.setting_input_int('pagecount', '탐색 페이지수', value=arg['pagecount'], min='1', placeholder='1')}}
        {{ macros.setting_checkbox('auto_start', '시작시 자동실행', value=arg['auto_start'], desc='On : 시작시 자동으로 스케쥴러에 등록됩니다.') }}
        {{ macros.setting_input_textarea('downlist', '자동 다운로드 할 만화 이름', value=arg['downlist'], row='5', desc=['구분자 |', '빈칸인 경우 모두 다운로드합니다.']) }}
        {{ macros.setting_input_textarea('blacklist', '다운로드 제외 만화 이름', value=arg['blacklist'], row='3', desc=['구분자 |']) }}
        {{ macros.setting_checkbox('all_download', 'All Download', value=arg['all_download'], desc=['On : 새로운 에피소드를 받을 때 이전 화 전부를 다운합니다.', '이미 받은 경우 제외']) }}
      {{ macros.m_tab_content_end() }}
  
      {{ macros.m_tab_content_start('etc', false) }}
        {{ macros.setting_button([['global_one_execute_btn', '1회 실행']], left='1회 실행' ) }}
        {{ macros.setting_button([['global_reset_db_btn', '목록 초기화']], left='DB정리' ) }}
      {{ macros.m_tab_content_end() }}
  </div><!--tab-content-->
  </form>
</div> <!--전체-->

<script type="text/javascript">

let package_name = "{{ arg['package_name'] }}";
let is_installed = "{{ arg['is_installed'] }}" ? true : false;
let current_version =  "{{ arg['current_version'] }}"
console.log(package_name, is_installed, current_version)

$(document).ready(function(){
});

$("body").on('click', '#install_btn', function (e) {
  console.log('install button clicked')
    $.get({
    url: '/' + package_name + '/ajax/install',
    success: function (data) {
      //command_modal_show('설치')
    }
  });
});

$("body").on('click', '#uninstall_btn', function (e) {
  $.get({
    url: '/' + package_name + '/ajax/uninstall',
    success: function (data) {
      //command_modal_show('제거')
    }
  });
});

  // $("body").on('click', '#uninstall_btn', function (e) {
  //   $.ajax({
  //     url: '/' + package_name + '/ajax/uninstall',
  //     type: "POST",
  //     cache: false,
  //     data: {},
  //     dataType: "json",
  //     success: function (data) {
  //       command_modal_show('제거')
  //     }
  //   });
  // });

  $('[id^=gallery-dl]').change(function () {
    console.log(this.id)
    use_collapse(this.id);
  });

</script>    
{% endblock %}